<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gym TV - Ultimate (YouTube + MP4 + Images)</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: Arial, sans-serif; }
        
        /* CONTENEUR GENERAL */
        #media-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; background: black;
        }

        /* 1. IMAGE */
        #bg-image {
            width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: none;
        }

        /* 2. VIDEO MP4 (Fichiers) */
        #bg-video {
            width: 100%; height: 100%;
            object-fit: cover; display: none;
        }

        /* 3. YOUTUBE (Embed) */
        #bg-youtube {
            width: 100%; height: 100%;
            border: none; display: none;
            pointer-events: none; /* Empêche de cliquer sur la vidéo */
        }

        /* TITRE & TEXTES */
        #main-title {
            position: absolute; top: 10%; left: 0; width: 100%;
            text-align: center; color: white; 
            font-size: 5vw; font-weight: bold;
            text-shadow: 3px 3px 6px #000;
            background: rgba(0,0,0,0.4); padding: 10px 0;
            z-index: 2;
        }

        #footer {
            position: fixed; bottom: 0; width: 100%; height: 80px;
            background: #D32F2F; z-index: 3; overflow: hidden;
            border-top: 2px solid white;
        }

        #scrolling-text {
            position: absolute; top: 15px; white-space: nowrap;
            color: white; font-size: 40px; font-weight: bold;
            left: 100%;
            animation: scroll 15s linear infinite;
        }

        @keyframes scroll { from { left: 100%; } to { left: -100%; } }
    </style>
</head>
<body>

    <div id="media-container">
        <div id="bg-image"></div>
        <video id="bg-video" muted playsinline></video>
        <iframe id="bg-youtube" src="" allow="autoplay; encrypted-media"></iframe>
    </div>

    <div id="main-title">Chargement...</div>
    
    <div id="footer">
        <div id="scrolling-text">...</div>
    </div>

<script>
    // --- CONFIGURATION ---
    var USE_GOOGLE_SHEET = false; 
    var SHEET_URL = 'TON_LIEN_CSV_ICI'; 
    // ---------------------

    // --- DONNÉES DE TEST (Ta vidéo YouTube est incluse ici) ---
    var testSlides = [
        {
            type: 'youtube', // Le code devinera tout seul, mais ici c'est pour le test
            url: "https://www.youtube.com/shorts/Yy4YngOZPvY", 
            title: "DÉMO GYM",
            text: "Voici la vidéo YouTube Short demandée qui s'affiche directement !",
            time: 15000 // IMPORTANT : Mettre la durée de la vidéo (ici 15 sec)
        },
        {
            type: 'image',
            url: "https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=1080",
            title: "IMAGE CLASSIQUE",
            text: "Le système alterne entre YouTube et les Images sans problème.",
            time: 8000
        }
    ];

    var slides = [];
    var currentIndex = 0;

    function startSystem() {
        if (USE_GOOGLE_SHEET) {
            loadFromSheet();
        } else {
            slides = testSlides;
            runSlideshow();
        }
    }

    // Fonction utilitaire pour extraire l'ID YouTube
    function getYouTubeID(url) {
        var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|shorts\/)([^#&?]*).*/;
        var match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    // Chargement CSV (identique code précédent)
    function loadFromSheet() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                parseCSV(xhr.responseText);
            }
        };
        xhr.open("GET", SHEET_URL + "?t=" + new Date().getTime(), true);
        xhr.send();
    }

    function parseCSV(text) {
        var rows = text.split('\n');
        slides = [];
        for (var i = 1; i < rows.length; i++) {
            var cols = rows[i].split(',');
            if (cols.length >= 4) {
                slides.push({
                    url: cols[0].trim(),
                    title: cols[1].trim(),
                    text: cols[2].trim(),
                    time: parseInt(cols[3]) * 1000
                });
            }
        }
        if (slides.length > 0) runSlideshow();
    }

    function runSlideshow() {
        var slide = slides[currentIndex];
        
        var imgDiv = document.getElementById('bg-image');
        var vidTag = document.getElementById('bg-video');
        var ytFrame = document.getElementById('bg-youtube');
        
        // Reset tout (cache tout)
        imgDiv.style.display = 'none';
        vidTag.style.display = 'none';
        vidTag.pause();
        ytFrame.style.display = 'none';
        ytFrame.src = ""; // Stop YouTube en vidant la source

        // Mise à jour textes
        document.getElementById('main-title').innerText = slide.title;
        var ticker = document.getElementById('scrolling-text');
        ticker.innerText = slide.text;
        ticker.style.animation = 'none';
        ticker.offsetHeight; 
        ticker.style.animation = "scroll 15s linear infinite";

        // --- LOGIQUE DE DÉTECTION ---
        var ytID = getYouTubeID(slide.url);

        if (ytID) {
            // C'EST DU YOUTUBE
            ytFrame.style.display = 'block';
            // On construit le lien "Embed" qui force la lecture auto + MUTE (obligatoire)
            // playlist=... et loop=1 permettent de boucler si la durée de slide est longue
            ytFrame.src = "https://www.youtube.com/embed/" + ytID + "?autoplay=1&mute=1&controls=0&loop=1&playlist=" + ytID;
        
        } else if (slide.url.indexOf('.mp4') !== -1) {
            // C'EST DU MP4 (Fichier)
            vidTag.style.display = 'block';
            vidTag.src = slide.url;
            vidTag.muted = true;
            vidTag.play().catch(function(e){console.log(e)});
        
        } else {
            // C'EST UNE IMAGE
            imgDiv.style.display = 'block';
            imgDiv.style.backgroundImage = "url('" + slide.url + "')";
        }

        // Timer
        currentIndex = (currentIndex + 1) % slides.length;
        setTimeout(runSlideshow, slide.time);
    }

    startSystem();

</script>
</body>
</html>
