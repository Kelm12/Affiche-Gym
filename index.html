<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gym TV - Mode Compatible</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: Arial, sans-serif; }
        
        /* IMAGE DE FOND */
        #background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            background-repeat: no-repeat;
            transition: opacity 1s; /* Animation simple */
        }

        /* TITRE */
        #main-title {
            position: absolute; top: 20%; left: 0; width: 100%;
            text-align: center; color: white; 
            font-size: 60px; /* Taille fixe pour éviter les bugs TV */
            font-weight: bold;
            text-shadow: 3px 3px 5px #000;
            background: rgba(0,0,0,0.5); padding: 20px 0;
        }

        /* BANDEAU DEFILANT */
        .ticker-wrap {
            position: absolute; bottom: 0; width: 100%; height: 80px;
            background-color: #D32F2F; overflow: hidden;
            border-top: 2px solid white;
        }
        .ticker-item {
            position: absolute; top: 15px;
            white-space: nowrap;
            color: white; font-size: 40px; font-weight: bold;
            /* Animation compatible vieux navigateurs */
            -webkit-animation: ticker 20s linear infinite;
            animation: ticker 20s linear infinite;
            left: 100%; /* Départ hors écran */
        }

        /* Animation standard et Webkit (pour vieilles TV) */
        @-webkit-keyframes ticker { 0% { -webkit-transform: translate3d(0, 0, 0); left: 100%; } 100% { -webkit-transform: translate3d(-100%, 0, 0); left: -100%; } }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); left: 100%; } 100% { transform: translate3d(-100%, 0, 0); left: -150%; } }
    </style>
</head>
<body>

    <div id="background"></div>
    <div id="main-title">Chargement...</div>
    <div class="ticker-wrap">
        <div class="ticker-item" id="scrolling-text">...</div>
    </div>
    
    <div id="error-msg" style="color:red; background:white; font-size:20px; position:absolute; top:0; z-index:999; display:none;"></div>

<script>
    // --- METS TON LIEN CSV ICI ---
    var SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS3DKkK7eA4ncA6o7H8Xo4o8MeExhAWXfR_8qaW5MV9GmKBabIfVQZAwr_6HOeC36e821ynssLZOjDQ/pub?gid=1855203844&single=true&output=csv'; 
    // -----------------------------

    var slides = [];
    var currentIndex = 0;

    // Fonction "Vieux Mode" pour charger les données (remplace fetch)
    function loadData() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    parseData(xhr.responseText);
                } else {
                    showError("Erreur chargement: " + xhr.status);
                }
            }
        };
        xhr.open("GET", SHEET_URL + "?t=" + new Date().getTime(), true); // Anti-cache automatique
        xhr.send();
    }

    function parseData(textData) {
        try {
            var rows = textData.split('\n');
            slides = []; // Reset
            
            // On commence à i=1 pour sauter le titre
            for (var i = 1; i < rows.length; i++) {
                var row = rows[i];
                // Séparation simple par virgule
                var cols = row.split(',');
                
                if (cols.length >= 4) {
                    var imgClean = cols[0].replace(/"/g, '').trim();
                    var titleClean = cols[1].replace(/"/g, '').trim();
                    var textClean = cols[2].replace(/"/g, '').trim();
                    var timeClean = parseInt(cols[3]);

                    if (imgClean && !isNaN(timeClean)) {
                        slides.push({
                            img: imgClean,
                            title: titleClean,
                            text: textClean,
                            time: timeClean * 1000
                        });
                    }
                }
            }

            if (slides.length > 0) {
                runSlideshow();
            } else {
                showError("Tableau vide ou mal formaté");
            }
        } catch (e) {
            showError("Erreur lecture: " + e.message);
        }
    }

    function runSlideshow() {
        var slide = slides[currentIndex];
        
        var bg = document.getElementById('background');
        var title = document.getElementById('main-title');
        var ticker = document.getElementById('scrolling-text');

        bg.style.backgroundImage = "url('" + slide.img + "')";
        title.innerHTML = slide.title;
        ticker.innerHTML = slide.text;

        // Reset animation (Astuce compatible vieux JS)
        ticker.style.animation = 'none';
        ticker.offsetHeight; /* trigger reflow */
        ticker.style.animation = null; 

        currentIndex++;
        if (currentIndex >= slides.length) {
            currentIndex = 0;
            // On recharge les données à la fin de la boucle pour les mises à jour
            // Mais on attend la fin du timer de la dernière slide
            setTimeout(function() { loadData(); }, slide.time); 
        } else {
            setTimeout(runSlideshow, slide.time);
        }
    }

    function showError(msg) {
        var errBox = document.getElementById('error-msg');
        errBox.style.display = 'block';
        errBox.innerHTML = msg;
    }

    // Démarrage
    loadData();

</script>
</body>
</html>
