<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Debug Mode - Gym</title>
    <style>
        body { background: #000; color: white; font-family: sans-serif; padding: 20px; }
        #debug-console { color: red; font-size: 20px; background: #222; padding: 20px; border: 1px solid red; }
        #background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-size: cover; background-position: center; }
        #main-title { position: absolute; top: 20%; width: 100%; text-align: center; font-size: 4em; text-shadow: 2px 2px 4px #000; }
        .ticker-wrap { position: absolute; bottom: 0; width: 100%; height: 60px; background: #D32F2F; overflow: hidden; }
        .ticker-item { display: inline-block; padding-left: 100%; animation: ticker 15s linear infinite; font-size: 2em; line-height: 60px; white-space: nowrap; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
    </style>
</head>
<body>

<div id="background"></div>
<div id="main-title">Chargement...</div>
<div class="ticker-wrap"><div class="ticker-item" id="ticker"></div></div>

<div id="debug-console" style="display:none;"></div>

<script>
    // --- COLLE TON LIEN CSV JUSTE EN DESSOUS ---
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS3DKkK7eA4ncA6o7H8Xo4o8MeExhAWXfR_8qaW5MV9GmKBabIfVQZAwr_6HOeC36e821ynssLZOjDQ/pub?gid=1855203844&single=true&output=csv'; 
    // ------------------------------------------

    function logError(msg) {
        const consoleDiv = document.getElementById('debug-console');
        consoleDiv.style.display = 'block';
        consoleDiv.innerHTML += "<p>" + msg + "</p>";
    }

    async function start() {
        try {
            // 1. Test du lien
            if (SHEET_URL.includes('TON_LIEN_CSV')) {
                throw new Error("Tu n'as pas remplacé le lien SHEET_URL dans le code !");
            }

            const response = await fetch(SHEET_URL);
            
            // 2. Test de la connexion
            if (!response.ok) {
                throw new Error("Impossible d'accéder au fichier Google (Erreur " + response.status + "). Vérifie que tu as bien fait 'Publier sur le web'.");
            }

            const data = await response.text();
            
            // 3. Test du contenu
            if (data.includes("<!DOCTYPE html>") || data.includes("<html")) {
                throw new Error("Le lien renvoie une page web et pas un CSV. Vérifie que tu as bien choisi format CSV dans Google Sheets.");
            }

            const rows = data.split('\n').slice(1); // Enlève la ligne de titre
            
            if (rows.length === 0) {
                throw new Error("Le fichier CSV semble vide.");
            }

            // Parsing simple (Attention aux virgules !)
            let slides = rows.map((row, index) => {
                // On essaie de séparer par virgule
                const cols = row.split(',');
                if (cols.length < 4) return null; // Ligne invalide
                
                return {
                    img: cols[0].trim(),
                    title: cols[1].trim(),
                    text: cols[2].trim(),
                    time: parseInt(cols[3]) * 1000
                };
            }).filter(s => s !== null);

            if (slides.length === 0) {
                throw new Error("Aucune ligne valide trouvée. Vérifie tes virgules !");
            }

            // Si tout est OK, on lance l'affichage
            document.getElementById('debug-console').style.display = 'none';
            let currentIndex = 0;

            function showSlide() {
                const s = slides[currentIndex];
                document.getElementById('background').style.backgroundImage = `url(${s.img})`;
                document.getElementById('main-title').innerText = s.title;
                
                const ticker = document.getElementById('ticker');
                ticker.innerText = s.text;
                // Reset animation
                ticker.style.animation = 'none';
                ticker.offsetHeight; 
                ticker.style.animation = null;

                currentIndex = (currentIndex + 1) % slides.length;
                setTimeout(showSlide, s.time || 5000);
            }
            showSlide();

        } catch (err) {
            document.getElementById('main-title').innerText = "ERREUR";
            logError("❌ " + err.message);
        }
    }

    start();
</script>
</body>
</html>
