<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Affichage Dynamique Gym</title>
    <style>
        /* RESET & BASE */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        /* IMAGE DE FOND */
        #background {
            width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 1s ease-in-out; /* Effet fondu */
        }

        /* TITRE PRINCIPAL (Au centre ou un peu en haut) */
        #main-title {
            position: absolute; top: 20%; left: 0; width: 100%;
            text-align: center;
            color: white; font-size: 5vw; font-weight: bold;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
            background: rgba(0, 0, 0, 0.4); /* Fond sombre semi-transparent pour lisibilité */
            padding: 20px 0;
        }

        /* BANDEAU TYPE "RATP/SNCF" (En bas) */
        .ticker-wrap {
            position: absolute; bottom: 0; width: 100%; height: 80px;
            background-color: #D32F2F; /* ROUGE GYM - Change cette couleur si tu veux */
            overflow: hidden; box-shadow: 0 -5px 15px rgba(0,0,0,0.5);
            display: flex; align-items: center;
        }

        .ticker-item {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%; /* Commence hors écran à droite */
            animation: ticker 15s linear infinite; /* Vitesse du défilement */
            color: white; font-size: 2.5rem; font-weight: bold;
        }

        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }
        
        /* Pour cacher le curseur de la souris */
        body { cursor: none; }
    </style>
</head>
<body>

    <div id="background"></div>

    <div id="main-title">Chargement...</div>

    <div class="ticker-wrap">
        <div class="ticker-item" id="scrolling-text">Bienvenue au Comité de Gymnastique de Normandie</div>
    </div>

<script>
    // --- CONFIGURATION ---
    // REMPLACE CECI PAR TON LIEN GOOGLE SHEET PUBLIÉ EN CSV
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS3DKkK7eA4ncA6o7H8Xo4o8MeExhAWXfR_8qaW5MV9GmKBabIfVQZAwr_6HOeC36e821ynssLZOjDQ/pub?gid=1855203844&single=true&output=csv'; 

    let slides = [];
    let currentIndex = 0;

    async function fetchData() {
        try {
            const response = await fetch(SHEET_URL);
            const data = await response.text();
            
            // Découpage du CSV (Attention aux virgules dans le texte !)
            // Astuce : On saute la ligne 1 (en-têtes)
            const rows = data.split('\n').slice(1);
            
            slides = rows.map(row => {
                // On utilise une expression régulière complexe pour gérer les virgules DANS les textes
                // Si c'est trop compliqué, évite juste les virgules dans ton Google Sheet pour l'instant
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                // Nettoyage des guillemets éventuels créés par Google Sheet
                const clean = (txt) => txt ? txt.replace(/^"|"$/g, '').trim() : "";

                return {
                    img: clean(cols[0]),
                    title: clean(cols[1]),
                    ticker: clean(cols[2]),
                    time: parseInt(clean(cols[3])) * 1000 // Conversion en millisecondes
                };
            }).filter(slide => slide.img && slide.time); // On garde que les lignes valides

            if(slides.length > 0) updateDisplay();

        } catch (error) {
            console.error("Erreur de chargement:", error);
        }
    }

    function updateDisplay() {
        const slide = slides[currentIndex];
        
        // Mise à jour de l'image
        document.getElementById('background').style.backgroundImage = `url('${slide.img}')`;
        
        // Mise à jour du titre
        document.getElementById('main-title').innerText = slide.title;
        
        // Mise à jour du texte défilant
        // Astuce : on relance l'animation CSS pour qu'elle reparte du début
        const ticker = document.getElementById('scrolling-text');
        ticker.innerText = slide.ticker;
        ticker.style.animation = 'none';
        ticker.offsetHeight; /* Trigger reflow */
        ticker.style.animation = null; 

        // Préparation de la prochaine slide
        currentIndex = (currentIndex + 1) % slides.length;
        
        // Si on a fait le tour, on recharge les données pour voir s'il y a des nouveautés
        if (currentIndex === 0) {
            fetchData(); // On recharge silencieusement
            setTimeout(updateDisplay, slide.time);
        } else {
            setTimeout(updateDisplay, slide.time);
        }
    }

    // Lancement
    fetchData();
    
    // Rafraîchissement de sécurité toutes les 5 minutes (au cas où le Wi-Fi saute)
    setInterval(fetchData, 300000);

</script>
</body>
</html>
