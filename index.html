<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gym TV Normandie - LITE</title>
    <style>
        /* RESET & BASE */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: Arial, sans-serif; }
        
        /* CONTENEUR MEDIA */
        #media-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; background: black;
        }

        /* 1. LAYER IMAGE */
        #bg-image {
            width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: none;
        }

        /* 2. LAYER FICHIER MP4 */
        #bg-video {
            width: 100%; height: 100%;
            object-fit: cover; display: none;
        }

        /* TEXTES */
        #main-title {
            position: absolute; top: 10%; left: 0; width: 100%;
            text-align: center; color: white; 
            font-size: 5vw; font-weight: bold;
            text-shadow: 3px 3px 8px #000;
            background: rgba(0,0,0,0.5); padding: 15px 0;
            z-index: 10;
        }

        #footer {
            position: fixed; bottom: 0; width: 100%; height: 80px;
            background: #D32F2F; z-index: 10; overflow: hidden;
            border-top: 3px solid white;
        }

        #scrolling-text {
            position: absolute; top: 15px; white-space: nowrap;
            color: white; font-size: 40px; font-weight: bold;
            left: 100%;
            animation: scroll 15s linear infinite;
        }

        @keyframes scroll { from { left: 100%; } to { left: -100%; } }

        /* DEBUG */
        #debug {
            position: absolute; top:0; left:0; color: red; background: white; z-index: 9999; display: none; font-size: 20px; padding: 10px;
        }
    </style>
</head>
<body>

    <div id="media-container">
        <div id="bg-image"></div>
        <video id="bg-video" muted playsinline></video>
    </div>

    <div id="main-title">Chargement Gym Normandie...</div>
    
    <div id="footer">
        <div id="scrolling-text">...</div>
    </div>
    
    <div id="debug"></div>

<script>
    // =================================================================
    // ZONE DE CONFIGURATION
    // =================================================================
    
    // ðŸ‘‡ COLLE TON LIEN CSV GOOGLE SHEET ICI ðŸ‘‡
    var SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS3DKkK7eA4ncA6o7H8Xo4o8MeExhAWXfR_8qaW5MV9GmKBabIfVQZAwr_6HOeC36e821ynssLZOjDQ/pub?gid=1855203844&single=true&output=csv'; 

    // =================================================================

    var slides = [];
    var currentIndex = 0;

    function init() {
        if (SHEET_URL.indexOf('https://docs.google.com/spreadsheets/d/e/2PACX-1vS3DKkK7eA4ncA6o7H8Xo4o8MeExhAWXfR_8qaW5MV9GmKBabIfVQZAwr_6HOeC36e821ynssLZOjDQ/pub?gid=1855203844&single=true&output=csv') !== -1) {
            showError("ERREUR : Tu as oubliÃ© de coller le lien CSV dans le fichier index.html !");
            return;
        }
        loadData();
    }

    function loadData() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    parseCSV(xhr.responseText);
                } else {
                    setTimeout(loadData, 10000); // RÃ©essaie dans 10s si erreur
                }
            }
        };
        // Anti-cache pour forcer la mise Ã  jour
        xhr.open("GET", SHEET_URL + "?t=" + new Date().getTime(), true);
        xhr.send();
    }

    function parseCSV(text) {
        var rows = text.split('\n');
        slides = [];
        
        for (var i = 1; i < rows.length; i++) {
            var row = rows[i];
            var cols = row.split(',');
            
            if (cols.length >= 4) {
                // Nettoyage des donnÃ©es
                var urlClean = cols[0].replace(/"/g, '').trim();
                var titleClean = cols[1].replace(/"/g, '').trim();
                var textClean = cols[2].replace(/"/g, '').trim();
                var timeClean = parseInt(cols[3]);

                if (urlClean.length > 5 && !isNaN(timeClean)) {
                    slides.push({
                        url: urlClean,
                        title: titleClean,
                        text: textClean,
                        time: timeClean * 1000
                    });
                }
            }
        }

        if (slides.length > 0) {
            runSlideshow();
        } else {
            showError("Tableau vide ou erreur de virgules.");
        }
    }

    function runSlideshow() {
        var slide = slides[currentIndex];
        
        var imgDiv = document.getElementById('bg-image');
        var vidTag = document.getElementById('bg-video');
        
        // 1. Mise Ã  jour Textes
        document.getElementById('main-title').innerText = slide.title;
        var ticker = document.getElementById('scrolling-text');
        ticker.innerText = slide.text;
        
        // Reset animation
        ticker.style.animation = 'none';
        ticker.offsetHeight; 
        ticker.style.animation = "scroll 15s linear infinite";

        // 2. Gestion MÃ©dia (Simple : MP4 ou Image)
        if (slide.url.indexOf('.mp4') !== -1) {
            // --- C'EST UNE VIDÃ‰O ---
            imgDiv.style.display = 'none';
            vidTag.style.display = 'block';
            vidTag.src = slide.url;
            vidTag.muted = true; // Obligatoire
            vidTag.play().catch(function(e){ console.log("Erreur lecture: ", e); });
        } else {
            // --- C'EST UNE IMAGE ---
            vidTag.pause();
            vidTag.style.display = 'none';
            imgDiv.style.display = 'block';
            imgDiv.style.backgroundImage = "url('" + slide.url + "')";
        }

        // 3. Boucle
        currentIndex++;
        if (currentIndex >= slides.length) {
            currentIndex = 0;
            // On recharge le CSV Ã  la fin de la boucle
            setTimeout(function() { loadData(); }, slide.time);
        } else {
            setTimeout(runSlideshow, slide.time);
        }
    }

    function showError(msg) {
        var d = document.getElementById('debug');
        d.style.display = 'block';
        d.innerHTML = msg;
    }

    // DÃ©marrage
    init();

</script>
</body>
</html>
